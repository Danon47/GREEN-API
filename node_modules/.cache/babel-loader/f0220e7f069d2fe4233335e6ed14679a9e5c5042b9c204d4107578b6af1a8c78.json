{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useNavigate}from'react-router-dom';import{TextField,Button,Container,Typography,Box,IconButton}from'@mui/material';import ExitToAppIcon from'@mui/icons-material/ExitToApp';import{sendMessage,receiveMessages}from'../api/greenApi';import Message from'./Message';import{jsxs as _jsxs,jsx as _jsx}from\"react/jsx-runtime\";const Chat=()=>{const[newMessage,setNewMessage]=useState('');const[messages,setMessages]=useState([]);const phoneNumber=localStorage.getItem('phoneNumber');const navigate=useNavigate();useEffect(()=>{const interval=setInterval(async()=>{try{const data=await receiveMessages();if(data){const messageData=data.body.messageData;if(messageData!==null&&messageData!==void 0&&messageData.textMessageData){const message=messageData.textMessageData.textMessage;setMessages(prev=>[...prev,{text:message,isMy:false}]);}}}catch(error){console.error('Ошибка при получении сообщений:',error);}},5000);return()=>clearInterval(interval);},[]);const handleLogout=()=>{if(window.confirm('Вы уверены, что хотите выйти?')){localStorage.removeItem('idInstance');localStorage.removeItem('apiToken');localStorage.removeItem('phoneNumber');navigate('/');}};const handleSend=async()=>{if(!newMessage){alert('Введите сообщение!');return;}try{await sendMessage(phoneNumber,newMessage);setMessages(prev=>[...prev,{text:newMessage,isMy:true}]);setNewMessage('');}catch(error){console.error('Ошибка отправки:',error);alert('Не удалось отправить сообщение. Проверьте данные и попробуйте снова.');}};return/*#__PURE__*/_jsxs(Container,{maxWidth:\"sm\",sx:{height:'100vh',display:'flex',flexDirection:'column',p:0,bgcolor:'#f0f2f5'},children:[/*#__PURE__*/_jsxs(Box,{sx:{bgcolor:'#00a884',color:'white',p:2,display:'flex',justifyContent:'space-between',alignItems:'center'},children:[/*#__PURE__*/_jsxs(Typography,{variant:\"h6\",sx:{fontWeight:'bold'},children:[\"\\u0427\\u0430\\u0442 \\u0441 \",phoneNumber]}),/*#__PURE__*/_jsx(IconButton,{onClick:handleLogout,sx:{color:'white','&:hover':{bgcolor:'rgba(255,255,255,0.1)'}},children:/*#__PURE__*/_jsx(ExitToAppIcon,{})})]}),/*#__PURE__*/_jsx(Box,{sx:{flex:1,overflowY:'auto',p:2,bgcolor:'#efeae2',backgroundImage:'url(\"https://web.whatsapp.com/img/bg-chat-tile-light_686b98c9fdffef3f63127759e2057750.png\")'},children:messages.map((msg,index)=>/*#__PURE__*/_jsx(Message,{text:msg.text,isMy:msg.isMy},index))}),/*#__PURE__*/_jsxs(Box,{sx:{bgcolor:'#f0f2f5',p:2,display:'flex',gap:1,alignItems:'center'},children:[/*#__PURE__*/_jsx(TextField,{fullWidth:true,variant:\"outlined\",value:newMessage,onChange:e=>setNewMessage(e.target.value),placeholder:\"\\u0412\\u0432\\u0435\\u0434\\u0438\\u0442\\u0435 \\u0441\\u043E\\u043E\\u0431\\u0449\\u0435\\u043D\\u0438\\u0435\",sx:{bgcolor:'white',borderRadius:6,'& .MuiOutlinedInput-root':{borderRadius:6}},onKeyPress:e=>e.key==='Enter'&&handleSend()}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"primary\",onClick:handleSend,sx:{borderRadius:'50%',minWidth:40,height:40,bgcolor:'#00a884','&:hover':{bgcolor:'#008f72'}},children:\"\\u27A4\"})]})]});};export default Chat;","map":{"version":3,"names":["React","useState","useEffect","useNavigate","TextField","Button","Container","Typography","Box","IconButton","ExitToAppIcon","sendMessage","receiveMessages","Message","jsxs","_jsxs","jsx","_jsx","Chat","newMessage","setNewMessage","messages","setMessages","phoneNumber","localStorage","getItem","navigate","interval","setInterval","data","messageData","body","textMessageData","message","textMessage","prev","text","isMy","error","console","clearInterval","handleLogout","window","confirm","removeItem","handleSend","alert","maxWidth","sx","height","display","flexDirection","p","bgcolor","children","color","justifyContent","alignItems","variant","fontWeight","onClick","flex","overflowY","backgroundImage","map","msg","index","gap","fullWidth","value","onChange","e","target","placeholder","borderRadius","onKeyPress","key","minWidth"],"sources":["E:/данин стол/danil.DESKTOP-EN4V9AA/Тестовые/Грин-Апи/green-api-chat/src/components/Chat.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { TextField, Button, Container, Typography, Box, IconButton } from '@mui/material';\r\nimport ExitToAppIcon from '@mui/icons-material/ExitToApp';\r\nimport { sendMessage, receiveMessages } from '../api/greenApi';\r\nimport Message from './Message';\r\n\r\nconst Chat = () => {\r\n  const [newMessage, setNewMessage] = useState('');\r\n  const [messages, setMessages] = useState([]);\r\n  const phoneNumber = localStorage.getItem('phoneNumber');\r\n  const navigate = useNavigate();\r\n\r\n  useEffect(() => {\r\n    const interval = setInterval(async () => {\r\n      try {\r\n        const data = await receiveMessages();\r\n        if (data) {\r\n          const messageData = data.body.messageData;\r\n          if (messageData?.textMessageData) {\r\n            const message = messageData.textMessageData.textMessage;\r\n            setMessages(prev => [...prev, { text: message, isMy: false }]);\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error('Ошибка при получении сообщений:', error);\r\n      }\r\n    }, 5000);\r\n\r\n    return () => clearInterval(interval);\r\n  }, []);\r\n\r\n  const handleLogout = () => {\r\n    if (window.confirm('Вы уверены, что хотите выйти?')) {\r\n      localStorage.removeItem('idInstance');\r\n      localStorage.removeItem('apiToken');\r\n      localStorage.removeItem('phoneNumber');\r\n      \r\n      navigate('/');\r\n    }\r\n  };\r\n\r\n  const handleSend = async () => {\r\n    if (!newMessage) {\r\n      alert('Введите сообщение!');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      await sendMessage(phoneNumber, newMessage);\r\n      setMessages(prev => [...prev, { text: newMessage, isMy: true }]);\r\n      setNewMessage('');\r\n    } catch (error) {\r\n      console.error('Ошибка отправки:', error);\r\n      alert('Не удалось отправить сообщение. Проверьте данные и попробуйте снова.');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Container\r\n      maxWidth=\"sm\"\r\n      sx={{\r\n        height: '100vh',\r\n        display: 'flex',\r\n        flexDirection: 'column',\r\n        p: 0,\r\n        bgcolor: '#f0f2f5',\r\n      }}\r\n    >\r\n      <Box\r\n        sx={{\r\n          bgcolor: '#00a884',\r\n          color: 'white',\r\n          p: 2,\r\n          display: 'flex',\r\n          justifyContent: 'space-between',\r\n          alignItems: 'center',\r\n        }}\r\n      >\r\n        <Typography variant=\"h6\" sx={{ fontWeight: 'bold' }}>\r\n          Чат с {phoneNumber}\r\n        </Typography>\r\n        \r\n        <IconButton\r\n          onClick={handleLogout}\r\n          sx={{\r\n            color: 'white',\r\n            '&:hover': {\r\n              bgcolor: 'rgba(255,255,255,0.1)'\r\n            }\r\n          }}\r\n        >\r\n          <ExitToAppIcon />\r\n        </IconButton>\r\n      </Box>\r\n\r\n      <Box\r\n        sx={{\r\n          flex: 1,\r\n          overflowY: 'auto',\r\n          p: 2,\r\n          bgcolor: '#efeae2',\r\n          backgroundImage: 'url(\"https://web.whatsapp.com/img/bg-chat-tile-light_686b98c9fdffef3f63127759e2057750.png\")',\r\n        }}\r\n      >\r\n        {messages.map((msg, index) => (\r\n          <Message key={index} text={msg.text} isMy={msg.isMy} />\r\n        ))}\r\n      </Box>\r\n\r\n      <Box\r\n        sx={{\r\n          bgcolor: '#f0f2f5',\r\n          p: 2,\r\n          display: 'flex',\r\n          gap: 1,\r\n          alignItems: 'center',\r\n        }}\r\n      >\r\n        <TextField\r\n          fullWidth\r\n          variant=\"outlined\"\r\n          value={newMessage}\r\n          onChange={(e) => setNewMessage(e.target.value)}\r\n          placeholder=\"Введите сообщение\"\r\n          sx={{\r\n            bgcolor: 'white',\r\n            borderRadius: 6,\r\n            '& .MuiOutlinedInput-root': {\r\n              borderRadius: 6,\r\n            },\r\n          }}\r\n          onKeyPress={(e) => e.key === 'Enter' && handleSend()}\r\n        />\r\n        <Button\r\n          variant=\"contained\"\r\n          color=\"primary\"\r\n          onClick={handleSend}\r\n          sx={{\r\n            borderRadius: '50%',\r\n            minWidth: 40,\r\n            height: 40,\r\n            bgcolor: '#00a884',\r\n            '&:hover': {\r\n              bgcolor: '#008f72',\r\n            },\r\n          }}\r\n        >\r\n          ➤\r\n        </Button>\r\n      </Box>\r\n    </Container>\r\n  );\r\n};\r\n\r\nexport default Chat;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}